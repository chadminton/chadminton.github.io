<html>
	<head>
		<title>North American Chadminton League</title>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="nacl.css">		
		<script src="https://www.youtube.com/player_api"></script>
		<script src="scripts/basic.js"></script>
		<script type="text/javascript">
			
			var teams, pods, cache = getLocalValue('nacl-cache') || {};
			
			var ready = function () {
				getJSONfile('nacl/league.json', function (lg) {
					teams = lg.league;
					getJSONfile('nacl/games.json', function (gm) {
						pods = gm.schedule;
						updatePage();
					});
				});
			};
			
			var setup = function (page) {
				hideAll();
				var path = page.split('/');
				var first = path[0] || 'day';
				
				switch(first) {
					case '#team':
						break;
					case '#standings':
						break;
					case '#stats':
						break;
					case '#day':
					default:
						var day = new Date();
						if (path.length > 1) {
							day = new Date(path[1]);
						} else {
							day.setHours(0);
							day.setMinutes(0);
							day.setSeconds(0);
						}
						showGames(day);
						break;
				}
			};
			
			var showGames = function (day) {
				console.log('showing games for ' + day);
				var t = pods.query({ date: day.toStringFormat('yyyy-MM-ddT00:00:00') });
                var guts = '';
                if (t.length == 1) {
                    getFile('nacl/game-template.html', function (template) {
                        
                        var getTeamInfo = function (team) {
							var wins = team.wins || 0;
							var losses = team.losses || 0;
							var html = '<div class="team" style="background-color: ' + 
										team.color1 + '; color: ' + 
										team.color2 + '; background-image: url(\'img/teams/' +
										team.abbr + '.png\');">';
                            html += '<div class="record">' + wins + '-' + losses + '</div>' +
									'<div class="city">' + team.city + '</div>' +
									'<div class="name">' + team.name + '</div>';  
							html += '</div>';
							return html;
                        };
                        
                        t[0].games.each(function (game) {
							// if game hasn't been played yet
							game.aScore = game.aScore || '';
							game.bScore = game.bScore || '';
							
                            var away = teams.getElementById(game.away == 'a' ? game.a : game.b);
                            var home = teams.getElementById(game.home == 'a' ? game.a : game.b);
                            var awayScore = game.away == 'a' ? game.aScore : game.bScore;
                            var homeScore = game.home == 'a' ? game.aScore : game.bScore;
							var awayWinner = awayScore > homeScore ? ' winner' : '';
							var homeWinner = homeScore > awayScore ? ' winner' : '';
                            guts += template.replace(/{{away-team}}/g, getTeamInfo(away))
                                    .replace(/{{home-team}}/g, getTeamInfo(home));
							if (awayScore != '' && homeScore != '') {
								guts = guts.replace(/{{away-score}}/g, '<div class="away score' + awayWinner + '">' + awayScore + '</div>')
										.replace(/{{home-score}}/g, '<div class="home score' + homeWinner + '">' + homeScore + '</div>');
							}
							else {
								guts = guts.replace(/{{away-score}}/g, '')
										.replace(/{{home-score}}/g, '');
							}
							dayContainer.children[1].innerHTML = guts;							
                        });
                    }); 
                } else {
					guts = 'No games';
				}
						
				var headerHtml = '<a class="nav" href="javascript:changeDay(-1)">&ltrif;</a> ' + 
								 'Games for ' + day.toStringFormat('M/d/yyyy') +
								 '<a class="nav" href="javascript:changeDay(1)">&rtrif;</a>';
				
				var dayContainer = get('#day');
				dayContainer.children[0].innerHTML = headerHtml;
				dayContainer.children[1].innerHTML = guts;
				dayContainer.style.display = 'block';
			};
			
			var changeDay = function (delta) {
				var page = window.location.hash;
				var path = page.split('/');
				var day = new Date();
				if (path.length > 1) {
					day = new Date(path[1]);
				}
				var ticks = day.getTime() + (delta * 24 * 60 * 60 * 1000);
				var next = new Date();
				next.setTime(ticks);
				window.location.hash = '#day/' + next.toStringFormat('M-d-yyyy');
			};
			
			var hideAll = function () {
				var divs = get('#content > div');
				divs.each(function (item) {
					item.style.display = 'none';
				});
			};
			
			var updatePage = function () {
				var page = window.location.hash;
				setup(page);
			};
			
		</script>
	</head>
	<body onload="ready()" onhashchange="updatePage()">
		<div id="top" class="nacl">
			<div class="links">
				<a href="https://www.facebook.com/chadmintonOhio/"><img src="img/facebook.png" /></a>
				<a href="https://twitter.com/chadm1nton"><img src="img/twitter.png" /></a>
			</div>
			<div class="logo"></div>
		</div>
		<div id="content">
			<div id="day">
				<div class="header">TODAY'S GAMES</div>
				<div class="body">
				</div>
			</div>
			<div id="team">
				<div class="header"></div>
				<div class="body">
				</div>
			</div>
		</div>
		<div id="footer">
			Chadminton &trade; 2004-2017
		</div>
	</body>
</html>