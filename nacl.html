<html>
	<head>
		<title>North American Chadminton League</title>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="nacl.css">		
		<script src="https://www.youtube.com/player_api"></script>
		<script src="scripts/basic.js"></script>
		<script type="text/javascript">
			
			var teams, pods, cache = getLocalValue('nacl-cache') || {};
			
			var ready = function () {
				getJSONfile('nacl/league.json', function (lg) {
					teams = lg.league;
					getJSONfile('nacl/games.json', function (gm) {
						pods = gm.schedule;
						updatePage();
					});
				});
			};
			
			var setup = function (page) {
				hideAll();
				var path = page.split('/');
				var first = path[0] || 'day';
				
				switch(first) {
					case '#team':
						break;
					case '#standings':
						break;
					case '#stats':
						break;
					case '#day':
					default:
						var day = new Date();
						if (path.length > 1) {
							day = new Date(path[1]);
						} else {
							day.setHours(0);
							day.setMinutes(0);
							day.setSeconds(0);
						}
						showGames(day);
						break;
				}
			};
			
			var showGames = function (day) {
				console.log('showing games for ' + day);
				var pods = pods.query({ date: day.toStringFormat('M/d/yyyy') });
                if (pods.length == 1) {
                    getFile('nacl/game-template.html', function (template) {
                        
                        var getTeamInfo = function (team) {
                            return team.wins + '-' + team.losses + ' ' + team.city + ' ' + team.name;  
                        };
                        
                        var guts = '';
                        pods[0].games.each(function (game) {
                            var away = teams.getElementById(game.away == 'a' ? game.a : game.b);
                            var home = teams.getElementById(game.home == 'a' ? game.a : game.b);
                            var awayScore = game.away == 'a' ? game.aScore : game.bScore;
                            var homeScore = game.home == 'a' ? game.aScore : game.bScore;
                            guts += template.replace(/{{away-team}}/g, getTeamInfo(away) + ' ' + awayScore)
                                    .replace(/{{home-team}}/g, getTeamInfo(home) + ' ' + homeScore);
                        });
                        var day = get('#day');
                        day.innerHTML = guts;
                        day.style.display = 'block';
                    }); 
                }
			};
			
			var hideAll = function () {
				var divs = get('#content > div');
				divs.each(function (item) {
					item.style.display = 'none';
				});
			};
			
			var updatePage = function () {
				var page = window.location.hash;
				setup(page);
			};
			
		</script>
	</head>
	<body onload="ready()" onhashchange="updatePage()">
		<div id="top" class="nacl">
			<div class="links">
				<a href="https://www.facebook.com/chadmintonOhio/"><img src="img/facebook.png" /></a>
				<a href="https://twitter.com/chadm1nton"><img src="img/twitter.png" /></a>
			</div>
			<div class="logo"></div>
		</div>
		<div id="content">
			<div id="day">
				<div class="header">TODAY'S GAMES</div>
				<div class="body">
				</div>
			</div>
			<div id="team">
				<div id="team-header" class="header"></div>
				<div class="body">
				</div>
			</div>
		</div>
		<div id="footer">
			Chadminton &trade; 2004-2017
		</div>
	</body>
</html>